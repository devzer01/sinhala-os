<?php

$si_config = [
    0x0D, 0x80, 0x0D, 0xFF, 0x00, 0x80, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0xf1, 0x82, 0x00, 0x00,
    0xf2, 0x83, 0x00, 0x00, 0x00, 0x84, 0x00, 0x00, 0x80, 0x85, 0x00, 0x00,
    0x88, 0x86, 0x00, 0x00, 0x81, 0x87, 0x00, 0x00, 0x89, 0x88, 0x00, 0x00,
    0x82, 0x89, 0x00, 0x00, 0x8a, 0x8A, 0x00, 0x00, 0x83, 0x8B, 0x00, 0x00,
    0x8b, 0x8C, 0x00, 0x00, 0x84, 0x8D, 0x00, 0x00, 0x8c, 0x8E, 0x00, 0x00,
    0x85, 0x8F, 0x00, 0x00, 0x8d, 0x90, 0x00, 0x00, 0x86, 0x91, 0x00, 0x00,
    0xa6, 0x92, 0x00, 0x00, 0x8e, 0x93, 0x00, 0x00, 0x87, 0x94, 0x00, 0x00,
    0xa7, 0x95, 0x00, 0x00, 0x8f, 0x96, 0x00, 0x00, 0x00, 0x97, 0x00, 0x00,
    0x00, 0x98, 0x00, 0x00, 0x00, 0x99, 0x00, 0x00, 0xb0, 0x9A, 0x00, 0x00,
    0xc0, 0x9B, 0x00, 0x00, 0xb1, 0x9C, 0x00, 0x00, 0xc1, 0x9D, 0x00, 0x00,
    0xbd, 0x9E, 0x00, 0x00, 0xd1, 0x9F, 0x00, 0x00, 0xb2, 0xA0, 0x00, 0x00,
    0xc2, 0xA1, 0x00, 0x00, 0xb3, 0xA2, 0x00, 0x00, 0xc3, 0xA3, 0x00, 0x00,
    0xcd, 0xA4, 0x00, 0x00, 0xdd, 0xA5, 0x00, 0x00, 0xd3, 0xA6, 0x00, 0x00,
    0xb4, 0xA7, 0x00, 0x00, 0xc4, 0xA8, 0x00, 0x00, 0xb5, 0xA9, 0x00, 0x00,
    0xc5, 0xAA, 0x00, 0x00, 0xc6, 0xAB, 0x00, 0x00, 0xd5, 0xAC, 0x00, 0x00,
    0xb7, 0xAD, 0x00, 0x00, 0xc7, 0xAE, 0x00, 0x00, 0xb8, 0xAF, 0x00, 0x00,
    0xc8, 0xB0, 0x00, 0x00, 0xb6, 0xB1, 0x00, 0x00, 0x00, 0xB2, 0x00, 0x00,
    0xd8, 0xB3, 0x00, 0x00, 0xb9, 0xB4, 0x00, 0x00, 0xc9, 0xB5, 0x00, 0x00,
    0xba, 0xB6, 0x00, 0x00, 0xca, 0xB7, 0x00, 0x00, 0xe2, 0xB8, 0x00, 0x00,
    0xda, 0xB9, 0x00, 0x00, 0xbf, 0xBA, 0x00, 0x00, 0xbe, 0xBB, 0x00, 0x00,
    0x00, 0xBC, 0x00, 0x00, 0xbb, 0xBD, 0x00, 0x00, 0x00, 0xBE, 0x00, 0x00,
    0x00, 0xBF, 0x00, 0x00, 0xe0, 0xC0, 0x00, 0x00, 0xcc, 0xC1, 0x00, 0x00,
    0xdc, 0xC2, 0x00, 0x00, 0xbc, 0xC3, 0x00, 0x00, 0xe1, 0xC4, 0x00, 0x00,
    0xcb, 0xC5, 0x00, 0x00, 0xe3, 0xC6, 0x00, 0x00, 0x00, 0xC7, 0x00, 0x00,
    0x00, 0xC8, 0x00, 0x00, 0x00, 0xC9, 0x00, 0x00, 0xf5, 0xCA, 0x00, 0x00,
    0x00, 0xCB, 0x00, 0x00, 0x00, 0xCC, 0x00, 0x00, 0x00, 0xCD, 0x00, 0x00,
    0x00, 0xCE, 0x00, 0x00, 0x98, 0xCF, 0x00, 0x00, 0x91, 0xD0, 0x00, 0x00,
    0x99, 0xD1, 0x00, 0x00, 0x92, 0xD2, 0x00, 0x00, 0x9a, 0xD3, 0x00, 0x00,
    0x93, 0xD4, 0x00, 0x00, 0x00, 0xD5, 0x00, 0x00, 0x9b, 0xD6, 0x00, 0x00,
    0x00, 0xD7, 0x00, 0x00, 0x94, 0xD8, 0x00, 0x00, 0x96, 0xD9, 0x00, 0x00,
    0xae, 0xDA, 0x00, 0x00, 0x9e, 0xDB, 0x00, 0x00, 0x97, 0xDC, 0x00, 0x00,
    0xaf, 0xDD, 0x00, 0x00, 0x9f, 0xDE, 0x00, 0x00, 0x95, 0xDF, 0x00, 0x00,
    0x00, 0xE0, 0x00, 0x00, 0x00, 0xE1, 0x00, 0x00, 0x00, 0xE2, 0x00, 0x00,
    0x00, 0xE3, 0x00, 0x00, 0x00, 0xE4, 0x00, 0x00, 0x00, 0xE5, 0x00, 0x00,
    0x00, 0xE6, 0x00, 0x00, 0x00, 0xE7, 0x00, 0x00, 0x00, 0xE8, 0x00, 0x00,
    0x00, 0xE9, 0x00, 0x00, 0x00, 0xEA, 0x00, 0x00, 0x00, 0xEB, 0x00, 0x00,
    0x00, 0xEC, 0x00, 0x00, 0x00, 0xED, 0x00, 0x00, 0x00, 0xEE, 0x00, 0x00,
    0x00, 0xEF, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xF1, 0x00, 0x00,
    0x9c, 0xF2, 0x00, 0x00, 0x9d, 0xF3, 0x00, 0x00, 0xf9, 0xF4, 0x00, 0x00,
    0x00, 0xF5, 0x00, 0x00, 0x00, 0xF6, 0x00, 0x00, 0x00, 0xF7, 0x00, 0x00,
    0x00, 0xF8, 0x00, 0x00, 0x00, 0xF9, 0x00, 0x00, 0x00, 0xFA, 0x00, 0x00,
    0x00, 0xFB, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00, 0xFD, 0x00, 0x00,
    0x00, 0xFE, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00
];

$map = [
    [ 0x80, 'SVI', 'A', ''],
    [ 0x81, 'SVI', 'AE', ''],
    [ 0x82, 'SVI', 'I', ''],
    [ 0x83, 'SVI', 'U', ''],
    [ 0x84, 'SVI', 'R', 'VOC'],
    [ 0x85, 'SVI', 'L', 'VOC'],
    [ 0x86, 'SVI', 'E', ''],
    [ 0x87, 'SVI', 'O', ''],
    [ 0x88, 'SVI', 'AA', ''],
    [ 0x89, 'SVI', 'AEE', ''],
    [ 0x8a, 'SVI', 'II', ''],
    [ 0x8b, 'SVI', 'UU', ''],
    [ 0x8c, 'SVI', 'RR', 'VOC'],
    [ 0x8d, 'SVI', 'LL', 'VOC'],
    [ 0x8e, 'SVI', 'AI', ''],
    [ 0x8f, 'SVI', 'AU', ''],
    [ 0x90, 'SVD', 'A', ''],
    [ 0x91, 'SVD', 'AE', ''],
    [ 0x92, 'SVD', 'I', ''],
    [ 0x93, 'SVD', 'U', ''],
    [ 0x94, 'SVD', 'R', 'VOC'],
    [ 0x95, 'SVD', 'L', 'VOC'],
    [ 0x96, 'SVD', 'E', ''],
    [ 0x97, 'SVD', 'O', ''],
    [ 0x98, 'SVD', 'AA', ''],
    [ 0x99, 'SVD', 'AEE', ''],
    [ 0x9a, 'SVD', 'II', ''],
    [ 0x9b, 'SVD', 'UU', ''],
    [ 0x9c, 'SVD', 'RR', 'VOC'],
    [ 0x9d, 'SVD', 'LL', 'VOC'],
    [ 0x9e, 'SVD', 'AI', ''],
    [ 0x9f, 'SVD', 'AU', ''],
    [ 0xa0, 'SVI', 'AAA', ''],
    [ 0xa1, 'SVI', 'EEE', ''],
    [ 0xa2, '###', '', ''],
    [ 0xa3, '###', '', ''],
    [ 0xa4, '###', '', ''],
    [ 0xa5, '###', '', ''],
    [ 0xa6, 'SVI', 'EE', ''],
    [ 0xa7, 'SVI', 'OO', ''],
    [ 0xa8, 'SVD', 'UE', ''],
    [ 0xa9, 'SVD', 'UUE', ''],
    [ 0xaa, 'SVD', 'OE', ''],
    [ 0xab, 'SVD', 'OOE', ''],
    [ 0xac, 'SVD', 'AW', ''],
    [ 0xad, 'SVD', 'OM', ''],
    [ 0xae, 'SVD', 'EE', ''],
    [ 0xaf, 'SVD', 'OO', ''],
    [ 0xb0, 'SC', 'KA', ''],
    [ 0xb1, 'SC', 'GA', ''],
    [ 0xb2, 'SC', 'CA', ''],
    [ 0xb3, 'SC', 'JA', ''],
    [ 0xb4, 'SC', 'TTA', ''],
    [ 0xb5, 'SC', 'DDA', ''],
    [ 0xb6, 'SC', 'NA', ''],
    [ 0xb7, 'SC', 'TA', ''],
    [ 0xb8, 'SC', 'DA', ''],
    [ 0xb9, 'SC', 'PA', ''],
    [ 0xba, 'SC', 'BA', ''],
    [ 0xbb, 'SC', 'LA', ''],
    [ 0xbc, 'SC', 'SA', ''],
    [ 0xbd, 'SC', 'NGA', ''],
    [ 0xbe, 'SC', 'RA', ''],
    [ 0xbf, 'SC', 'YA', ''],
    [ 0xc0, 'SC', 'KHA', ''],
    [ 0xc1, 'SC', 'GHA', ''],
    [ 0xc2, 'SC', 'CHA', ''],
    [ 0xc3, 'SC', 'JHA', ''],
    [ 0xc4, 'SC', 'TTHA', ''],
    [ 0xc5, 'SC', 'DDHA', ''],
    [ 0xc6, 'SC', 'NHA', ''],
    [ 0xc7, 'SC', 'THA', ''],
    [ 0xc8, 'SC', 'DHA', ''],
    [ 0xc9, 'SC', 'PHA', ''],
    [ 0xca, 'SC', 'BHA', ''],
    [ 0xcb, 'SC', 'LLA', ''],
    [ 0xcc, 'SC', 'SHA', ''],
    [ 0xcd, 'SC', 'NYA', ''],
    [ 0xce, 'SC', 'RHA', ''],
    [ 0xcf, 'SC', 'YHA', ''],
    [ 0xd0, 'SCN', 'KHHA', ''],
    [ 0xd1, 'SCN', 'GHA', ''],
    [ 0xd2, '###', '', ''],
    [ 0xd3, 'SCN', 'JHA', ''],
    [ 0xd4, '###', '', ''],
    [ 0xd5, 'SCN', 'DDDHA', ''],
    [ 0xd6, 'SCN', 'NNNA', ''],
    [ 0xd7, '###', '', ''],
    [ 0xd8, 'SCN', 'DHA', ''],
    [ 0xd9, '###', '', ''],
    [ 0xda, 'SCN', 'BHA', ''],
    [ 0xdb, 'SCN', 'LLLA', ''],
    [ 0xdc, 'SC', 'SSA', ''],
    [ 0xdd, 'SCN', 'NYA', ''],
    [ 0xde, 'SC', 'RRA', ''],
    [ 0xdf, 'SC', 'YYA', ''],
    [ 0xe0, 'SC', 'VA', ''],
    [ 0xe1, 'SC', 'HA', ''],
    [ 0xe2, 'SC', 'MA', ''],
    [ 0xe3, 'SC', 'FA', ''],
    [ 0xe4, 'SC', 'QA', ''],
    [ 0xe5, 'SC', 'ZA', ''],
    [ 0xe6, 'SC', 'ZHA', ''],
    [ 0xe7, '###', '', ''],
    [ 0xe8, '###', '', ''],
    [ 0xe9, '###', '', ''],
    [ 0xea, 'SVI', 'AW', ''],
    [ 0xeb, 'SVI', 'UE', ''],
    [ 0xec, 'SVI', 'UUE', ''],
    [ 0xed, '###', '', ''],
    [ 0xee, '###', '', ''],
    [ 0xef, '###', '', ''],
    [ 0xf0, 'SS', 'CANDRABINDU', ''],
    [ 0xf1, 'SS', 'ANUSVARA', ''],
    [ 0xf2, 'SS', 'VISARGA', ''],
    [ 0xf3, 'SS', 'JIHVAMULIYA', ''],
    [ 0xf4, 'SS', 'UPADHMANIYA', ''],
    [ 0xf5, 'SS', 'VIRAMA', ''],
    [ 0xf6, 'SS', 'NUKTA', ''],
    [ 0xf7, 'SS', 'INVERTED', 'CHAN'],
    [ 0xf8, 'SS', 'AVAGRAHA', ''],
    [ 0xf9, 'SS', 'DANDA', ''],
    [ 0xfa, 'SS', 'DANDA', ''],
    [ 0xfb, 'SS', 'GRAVE', ''],
    [ 0xfc, 'SS', 'ACUTE', ''],
    [ 0xfd, 'SS', 'UDATTA', ''],
    [ 0xfe, 'SS', 'ANUDATTA', ''],
    [ 0xff, 'SS', 'ACCENT', ''],
    [ 0x31, 'N', '1', ''],
    [ 0x32, 'N', '2', ''],
    [ 0x33, 'N', '3', ''],
    [ 0x34, 'N', '4', ''],
    [ 0x35, 'N', '5', ''],
    [ 0x36, 'N', '6', ''],
    [ 0x37, 'N', '7', ''],
    [ 0x38, 'N', '8', ''],
    [ 0x39, 'N', '9', ''],
    [ 0x40, 'N', '10', ''],
    [ 0x30, 'N', '0', ''],
];

define("C_CODE", 0);
define("C_CLASS", 1);
define("C_NAME", 2);
define("C_ATTR", 3);

$vi = array_filter($map, function ($v) {
    if ($v[C_CLASS] === "SVI" || $v[C_CLASS] == "SVD") {
        return true;
    }
    return false;
}, ARRAY_FILTER_USE_BOTH);


$matrix8 = [];
$matrix16 = [];
$si = new sinhala();
for ($r = 0; $r < 6; $r++) {
    for ($c = 0; $c < 8; $c++) {
        //printf("c %d r %d f %d </br>", $c, $r, ($r * 8) + $c);
        $idx = ($r * 8) + $c;

        $map[$idx]["si"]  = [ $si->code($idx), $si->point($idx)];
        $matrix8[$r][$c] = $map[$idx];
    }
}


for ($r = 3; $r < 16; $r++) {
    for ($c = 0; $c < 16; $c++) {
        //printf("c %d r %d f %d </br>", $c, $r, ($r * 8) + $c);
        $idx = ($r * 16) + $c;

        $map[$idx]["si"]  = [ $si->code($idx), $si->point($idx)];
        $matrix16[$r][$c] = $map[$idx];
    }
}



class sinhala extends map {
    public function __construct()
    {
        global $si_config;
        parent::__construct($si_config);
    }
}

class map {
    private $map = [];
    private $start = 0x00;
    private $offset = 0x80;
    public function __construct($map)
    {
        $this->start = $map[0] << 8;
        $this->map = $map;
    }

    private function __seek($index)
    {
        $idx = $this->offset + $index;
        for ($i = 1; $i <= 128; $i++) {
            $cursor = ($i * 4);
            if ($this->map[$cursor] == $idx) {
                return $cursor;
            }
        }
    }

    public function code($index) {
        return $this->map[$this->__seek($index)];
    }

    public function point($index) {
        return $this->start + $this->map[$this->__seek($index) + 1];
    }

}