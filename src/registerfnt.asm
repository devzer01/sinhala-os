;
; label = address (ptr)
; [label] = value (*ptr)
[BITS 16]
[ORG  0x7c00]
boot:
    mov ax,13h
    int 10h
    mov ax, 4f02h
    mov bx, 0105h
    int 10h
    cmp ax, 004fh
    je modeerr

start:

    push 0a000h
    pop es
    mov ax, chars
    mov si, ax
    mov dx, 16
    mov bx, 12
    xor di,di
loop2:
    push di
charloop:
    xor al, al
    cmp [ds:si], al
    jne setdraw
    jmp skipdraw
setdraw:
    mov al, 03h
    ; draw 5 pixels with "ah:al" color, ++color, di += 5
skipdraw:
    mov [es:di],al
    inc di
    inc si
    dec dx
    jnz charloop
    pop di
    add di, 320 ; move di to start of next line
    mov dx, 16
    dec bx     ; do next single pixel line
    jnz loop2
    xor ah,ah
    int 16h
    hlt

modeerr:
    push ax
    push bx
    push cx
    push dx
    push di
    mov ax, 1300h
    mov bx, 0606h
    mov cx, 07h
    mov dx, 1040h
    mov di, msg
    mov [es:bp], di
    int 10h
    pop di
    pop dx
    pop cx
    pop bx
    pop ax
    hlt

msg db 'unknown error swicthing video', 10, 13, $
msglen equ $-msg

font: db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 ;;0000000000000000
somef2 db 0x00,0x00,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00 ;;0011011111110000
somef3 db 0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00 ;;0111111000011000
somef4 db 0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00 ;;0011111100001100
somef5 db 0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x01,0x00,0x00 ;;0011000010000100
somef6 db 0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00 ;;0010000001000100
somef7 db 0x00,0x01,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00 ;;0110010001000100
somef8 db 0x00,0x00,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00 ;;0010010001000100
somef9 db 0x00,0x00,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00 ;;0010010001000100
somef10 db 0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x01,0x00,0x00,0x00 ;0x0000x0110x0110x0110x0110x0000x0100x0000x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  ;
somef11 db 0x00,0x00,0x00,0x01,0x01,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00 ;0x0000x0010x0100x0110x0110x0110x0000x0000x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  ;

    times 510-($-$$) db 0
end:
    dw 0xAA55

incbin "fontdriver"

